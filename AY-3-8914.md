# AY-3-8914 Sound Chip Overview

## Origin and Role in Intellivision
- General Instrument AY-3-8914 is a Programmable Sound Generator (PSG) derived from the AY-3-8910 family.
- It powers all Intellivision console audio; no additional hardware voices exist, so every audible element must be scheduled on this chip.
- Functionally identical to AY-3-8910/8912 tone generation but without the parallel I/O ports; Intellivision maps its PSG registers into the system bus.

## Signal Path Highlights
- **Voices:** 3 independent square-wave tone generators (channels A, B, C), each combining with a shared noise source.
- **Noise Source:** One pseudo-random generator with programmable period that can be mixed into any voice.
- **Amplitude Control:** 4-bit (0–15) attenuation per channel plus optional envelope generator takeover.
- **Envelope Generator:** Hardware ADSR-like sequencer offering 16 predefined shapes, 16-bit period, and automatic retriggering based on shape bits.
- **Output Mix:** Sum of the three channels; no per-channel panning on original hardware.

## Clocking and Frequency Ranges
- The PSG input clock on Intellivision is ~3.579545 MHz (color subcarrier) divided by 2 internally for tone generation (≈1.7897725 MHz effective).
- Each tone channel uses a 10-bit period value (`N = coarse<<8 | fine`), so frequency `f = clock / (16 * N)`.
  - Practical pitch range: ~27 Hz (N=1023) up to ~1.1 MHz (N=1), but aliasing limits musical use to ≈7 kHz.
- Noise generator uses a 5-bit period register with `f_noise = clock / (32 * (N + 1))` and feeds all channels that enable noise.

## Register Map (16 locations, write-only on Intellivision)
| Reg | Purpose | Notes |
| --- | ------- | ----- |
| R0 | Channel A fine period | Lower 8 bits |
| R1 | Channel A coarse period | Upper 2 bits used |
| R2 | Channel B fine period | Lower 8 bits |
| R3 | Channel B coarse period | Upper 2 bits used |
| R4 | Channel C fine period | Lower 8 bits |
| R5 | Channel C coarse period | Upper 2 bits used |
| R6 | Noise period | 5-bit value; 0 treated as 1 |
| R7 | Mixer | Bits 0–2 disable tone A/B/C, bits 3–5 disable noise A/B/C; 1=disable |
| R8 | Channel A amplitude | 0–15 or bit4=1 to use envelope |
| R9 | Channel B amplitude | Same |
| R10 | Channel C amplitude | Same |
| R11 | Envelope period low | 8 bits |
| R12 | Envelope period high | 8 bits |
| R13 | Envelope shape | Bits set sustain/alternate/hold; 16 total shapes |
| R14 | Port A | Not bonded out on AY-3-8914 |
| R15 | Port B | Not bonded out on AY-3-8914 |

## Envelope Shapes at a Glance
- Shape bits: `C B A` (Hold, Alternate, Attack) with continuous/retrigger semantics.
- Key patterns:
  - `0b000`: sawtooth decay, repeats.
  - `0b001`: sawtooth decay then hold at 0.
  - `0b010`: sawtooth attack, repeats.
  - `0b011`: attack then hold at max.
  - `0b100/101/110/111`: add alternate + hold permutations for triangle-like or single-shot shapes.
- Writing R13 restarts the envelope and loads volume when channels use envelope mode.

## Known Hardware Constraints
- Writes are latched through a PSG address port followed by a data port (Intellivision exposes both at $01F0 and $01F1).
- Register writes have latency (~3 PSG clock cycles); avoid tight polling loops that assume immediate effect.
- No hardware LFO or filters; complex timbres require manual register modulation.
- Noise and tone share the same output ladder per channel, so simultaneous tone+noise mixes toward the higher amplitude.

## Design Considerations for the Editor
- Provide abstractions for frequency to note translation using the 10-bit period formula.
- Visualize per-channel envelope/volume automation with 16-step granularity.
- Include safeguards for noise generator abuse (e.g., warn when period=0).
- Since envelope is chip-wide but per-channel opt-in, editor should track envelope state globally and show which channels follow it.
